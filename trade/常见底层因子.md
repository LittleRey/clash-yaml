# 市场分析底层因子表

## 1️⃣ 价（Price）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 位移 | ΔP = close - close[k] | 动量、ROC、MACD |
| 极值差 | high - low | 日内波动、ATR、Keltner |
| 位置比 | (close - low) / (high - low) | 随机类（Stochastic、Williams %R） |
| 中点偏离 | close - (high+low)/2 | CCI、终极振荡器 |
| 均值偏离 | close - SMA(close,n) | 布林带、Z-score |

## 2️⃣ 量（Volume）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 价×量 | typical_price × volume | MFI、VWAP、资金流 |
| 量价比 | volume / (high-low) | 每点波动背后的成交密度 |
| 净流入 | sign(ΔP) × volume | OBV、ADL |
| 主动买卖 | up_tick_vol - down_tick_vol | 订单流、Delta |

## 3️⃣ 时间（Time / Bars）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 周期计数 | bars_since(condition) | 动量衰减、持仓时间 |
| 日内时段 | hour % 24 | 成交量分布、时段因子 |
| 周期归一 | bar_index % n | 周期类指标（Hilbert、傅里叶） |

## 4️⃣ 波动率（Volatility）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 平均波幅 | mean(high-low,n) | ATR、Chaikin Volatility |
| 标准差 | stdev(close,n) | 布林带、Z-score |
| 对数收益 | ln(close/close[1]) | GARCH、历史波动率 |
| 真波幅 | max(high-low, abs(high-close[1]), abs(low-close[1])) | ATR、Keltner |

## 5️⃣ 价差 / 相对价（Spread / Relative Price）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 价差 | close_A - close_B | 跨品种套利、配对交易 |
| 比价 | close_A / close_B | 相对强弱、期现比 |
| 对数比价 | ln(close_A / close_B) | 协整分析、均值回归 |
| 价差标准化 | (spread - mean(spread,n)) / stdev(spread,n) | 统计套利、异常检测 |

## 6️⃣ 累积 / 状态量（Cumulative / State Variables）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 累积和 | cum(close - close[1]) | 趋势强度、资金净流 |
| 累积成交额 | cum(price × volume) | 长期资金流向 |
| 连续涨跌天数 | sign(ΔP) 累加 | 趋势惯性、反转信号 |
| 布尔条件累计 | cum(condition) | 信号持续时间分析 |

## 7️⃣ 排序 / 位置（Rank / Position）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 区间排名 | rank(close, n) | 百分位因子、动量 |
| 极值位置 | argmax(high, n) / argmin(low, n) | 突破点、形态分析 |
| 百分位 | (close - lowest(low, n)) / (highest(high, n) - lowest(low, n)) | Stochastic、RSV |

## 8️⃣ 形态 / 结构（Pattern / Structure）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| K线实体比 | abs(close - open) / (high - low) | 强弱判断、趋势过滤 |
| 上下影线比 | (high - max(open,close)) / (min(open,close) - low) | 反转信号、Pin Bar识别 |
| 分形点 | high > high[1] and high > high[-1]（低点类似） | 趋势波段识别 |
| 波峰波谷间距 | high_fractal - low_fractal | 波段测量、江恩分析 |

## 9️⃣ 市场微结构（Microstructure）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| Tick方向比 | up_ticks / (up_ticks + down_ticks) | 内部买卖压力 |
| 成交簇密度 | trades_per_second | 高频交易检测 |
| 成交价偏移 | execution_price - mid_price | 流动性分析、冲击成本 |
| 撤单率 | canceled_orders / total_orders | 主力意图判断 |

## 🔟 数学变换 / 信号处理（Transform）
| 逻辑 | 原子公式 | 典型用途 |
|------|----------|----------|
| 差分 | ΔP, Δ²P | 动量、高阶动量 |
| 滤波 | EMA、Kalman、Savitzky-Golay | 去噪、平滑趋势 |
| 卷积 | Σ(P × kernel) | 模式匹配 |
| 傅里叶变换 | FFT(P) | 周期提取、季节性分析 |
| 希尔伯特变换 | Hilbert(P) | 瞬时周期、相位 |
